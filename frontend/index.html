<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indicore AI - Multilingual Chatbot</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
         :root {
            --primary-gradient-start: #7c4dff;
            --primary-gradient-end: #5b3ac2;
            --primary-color: #7c4dff;
            --accent-color: #5b3ac2;
            --background-light: #f8f9fa;
            --background-card: #ffffff;
            --text-dark: #212529;
            --text-medium: #6c757d;
            --border-light: #e9ecef;
            --shadow-light: rgba(0, 0, 0, 0.05);
            --shadow-medium: rgba(0, 0, 0, 0.12);
            --shadow-strong: rgba(0, 0, 0, 0.2);
            --success-color: #28a745;
            --error-color: #dc3545;
            --primary-color-rgb: 124, 77, 255;
            --error-color-rgb: 220, 53, 69;
            --success-color-rgb: 40, 167, 69;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--text-dark);
            overflow: hidden;
        }
        
        .chat-container {
            background: var(--background-card);
            border-radius: 28px;
            box-shadow: 0 20px 50px var(--shadow-strong);
            width: 100%;
            max-width: 900px;
            height: 700px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform: scale(0.98);
            animation: containerLoad 0.6s ease-out forwards;
        }
        
        @keyframes containerLoad {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 15px var(--shadow-medium);
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.95;
            font-weight: 300;
        }
        
        .settings-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            padding: 12px 18px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .settings-toggle:hover {
            background: rgba(255, 255, 255, 0.45);
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .mode-toggle {
            position: absolute;
            top: 25px;
            left: 25px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            padding: 12px 18px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .mode-toggle:hover {
            background: rgba(255, 255, 255, 0.45);
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .settings-panel {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--background-card);
            z-index: 1000;
            padding: 35px;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 0 40px var(--shadow-strong);
        }
        
        .settings-panel.active {
            transform: translateX(0);
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-light);
        }
        
        .settings-header h2 {
            color: var(--text-dark);
            font-size: 26px;
            font-weight: 600;
        }
        
        .close-settings {
            background: var(--error-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .close-settings:hover {
            background: #e63946;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .settings-grid {
            display: grid;
            gap: 30px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-dark);
            font-size: 16px;
        }
        
        .form-group input[type="text"],
        .form-group select,
        .form-group textarea {
            padding: 16px;
            border: 1px solid var(--border-light);
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            color: var(--text-dark);
            background-color: var(--background-light);
            box-shadow: inset 0 1px 3px var(--shadow-light);
        }
        
        .form-group input[type="text"]:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(var(--primary-color-rgb), 0.25), inset 0 1px 3px var(--shadow-medium);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .model-info,
        .language-support-info {
            font-size: 14px;
            color: var(--text-medium);
            margin-top: 10px;
            font-style: italic;
        }
        
        .api-notice {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 25px;
            font-size: 16px;
            text-align: center;
            border: 1px solid #c3e6cb;
            font-weight: 500;
        }
        
        .messages {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: var(--background-light);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .messages::-webkit-scrollbar {
            width: 8px;
        }
        
        .messages::-webkit-scrollbar-track {
            background: var(--border-light);
            border-radius: 10px;
        }
        
        .messages::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
            transition: background 0.3s ease;
        }
        
        .messages::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color);
        }
        
        .message {
            display: flex;
            align-items: flex-start;
            animation: fadeIn 0.5s ease-out forwards;
            max-width: 85%;
            transform: translateX(0);
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message.user {
            justify-content: flex-end;
            margin-left: auto;
        }
        
        .message-content {
            padding: 16px 22px;
            border-radius: 25px;
            font-size: 16px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
            box-shadow: 0 5px 15px var(--shadow-light);
            transition: transform 0.2s ease;
        }
        
        .message.user .message-content {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: white;
            border-bottom-right-radius: 10px;
        }
        
        .message.assistant .message-content {
            background: var(--background-card);
            color: var(--text-dark);
            border: 1px solid var(--border-light);
            border-bottom-left-radius: 10px;
        }
        
        .chat-container.speech-mode .message.assistant {
            display: none;
        }
        
        .input-container {
            padding: 25px 30px;
            background: var(--background-card);
            border-top: 1px solid var(--border-light);
            display: flex;
            gap: 15px;
            align-items: center;
            box-shadow: 0 -5px 15px var(--shadow-light);
        }
        
        .message-input {
            flex: 1;
            padding: 16px 22px;
            border: 1px solid var(--border-light);
            border-radius: 35px;
            font-size: 17px;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: var(--background-light);
            box-shadow: inset 0 1px 3px var(--shadow-light);
        }
        
        .message-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(var(--primary-color-rgb), 0.25), inset 0 1px 3px var(--shadow-medium);
        }
        
        .send-button {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 35px;
            cursor: pointer;
            font-size: 17px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 20px rgba(var(--primary-color-rgb), 0.35);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .send-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(var(--primary-color-rgb), 0.5);
        }
        
        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .mic-button {
            background: var(--background-light);
            color: var(--text-dark);
            border: 1px solid var(--border-light);
            border-radius: 50%;
            padding: 16px;
            cursor: pointer;
            font-size: 22px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 58px;
            height: 58px;
            box-shadow: 0 3px 8px var(--shadow-light);
        }
        
        .mic-button:hover {
            background: #eef2f5;
            color: var(--primary-color);
            border-color: var(--primary-color);
            box-shadow: 0 5px 12px var(--shadow-medium);
        }
        
        .mic-button.recording {
            background: var(--error-color);
            color: white;
            border-color: var(--error-color);
            animation: pulse 1.2s infinite cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(var(--error-color-rgb), 0.6);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 0 0 15px rgba(var(--error-color-rgb), 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(var(--error-color-rgb), 0);
            }
        }
        
        @keyframes bounceIn {
            0% {
                transform: translateY(-50%) scale(0.6);
                opacity: 0;
            }
            60% {
                transform: translateY(-50%) scale(1.1);
                opacity: 1;
            }
            80% {
                transform: translateY(-50%) scale(0.97);
            }
            100% {
                transform: translateY(-50%) scale(1);
            }
        }
        
        .voice-dialog {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
        }
        
        .voice-dialog-content {
            background: var(--background-card);
            padding: 35px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 15px 40px var(--shadow-strong);
            position: relative;
            animation: slideInUp 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        @keyframes slideInUp {
            from {
                transform: translateY(80px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .voice-dialog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-light);
            width: 100%;
        }
        
        .voice-dialog-header h3 {
            font-size: 24px;
            color: var(--text-dark);
            font-weight: 600;
        }
        
        .close-dialog {
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: var(--text-medium);
            transition: color 0.2s ease;
        }
        
        .close-dialog:hover {
            color: var(--error-color);
        }
        
        #voiceStatus {
            margin-bottom: 20px;
            font-size: 16px;
            color: var(--text-medium);
            text-align: center;
            font-weight: 500;
            width: 100%;
        }
        
        #transcription {
            min-height: 100px;
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 25px;
            background: var(--background-light);
            font-style: italic;
            color: var(--text-dark);
            font-size: 16px;
            line-height: 1.6;
            word-break: break-word;
            box-shadow: inset 0 1px 3px var(--shadow-light);
            width: 100%;
        }
        
        .voice-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            width: 100%;
            flex-wrap: wrap;
        }
        
        .voice-actions button {
            padding: 14px 22px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            flex-grow: 1;
            min-width: 120px;
        }
        
        .voice-actions button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        #startListening {
            background: var(--success-color);
            color: white;
        }
        
        #startListening:hover:enabled {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(var(--success-color-rgb), 0.3);
        }
        
        #stopListening {
            background: var(--error-color);
            color: white;
        }
        
        #stopListening:hover:enabled {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(var(--error-color-rgb), 0.3);
        }
        
        #sendVoiceMessage {
            background: var(--primary-color);
            color: white;
        }
        
        #sendVoiceMessage:hover:enabled {
            background: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(var(--primary-color-rgb), 0.3);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 18px;
            color: var(--text-medium);
            font-style: italic;
            font-size: 16px;
            background: var(--background-light);
            border-top: 1px solid var(--border-light);
            animation: pulseText 1.5s infinite ease-in-out;
        }
        
        @keyframes pulseText {
            0% {
                opacity: 0.7;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0.7;
            }
        }
        
        .loading.active {
            display: block;
        }
        
        .language-support-info {
            font-size: 13px;
            color: var(--text-medium);
            margin-top: 10px;
            font-style: italic;
        }
        
        .text-mode .mic-button {
            display: none;
        }
        
        .text-mode .message-input,
        .text-mode .send-button {
            display: flex;
        }
        
        .speech-mode .message-input,
        .speech-mode .send-button {
            display: none;
        }
        
        .speech-mode .mic-button {
            display: flex;
        }
        
        .speech-mode #voiceDialog .loading-indicator {
            display: none;
            margin-top: 15px;
            font-size: 15px;
            color: var(--text-medium);
            font-style: italic;
            animation: pulseText 1.5s infinite ease-in-out;
        }
        
        .speech-mode #voiceDialog .loading-indicator.active {
            display: block;
        }
        
        #stopBotResponseButtonDialog {
            background: #f44336;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            width: fit-content;
            align-self: center;
            display: none;
        }
        
        #stopBotResponseButtonDialog:hover {
            background: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        #stopBotToggle {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            width: fit-content;
        }
        
        #stopBotToggle.active {
            background: var(--error-color);
            box-shadow: 0 4px 10px rgba(var(--error-color-rgb), 0.3);
        }
        
        #stopBotToggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        #stopBotToggle.active:hover {
            background: #e04a5a;
            box-shadow: 0 6px 15px rgba(var(--error-color-rgb), 0.45);
        }
        
        .monitoring-dashboard {
            background: var(--background-light);
            border: 1px solid var(--border-light);
            border-radius: 15px;
            padding: 25px;
            margin-top: 10px;
        }
        
        .monitoring-dashboard .stat-card {
            background: var(--background-card);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 3px 8px var(--shadow-light);
            margin-bottom: 15px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .monitoring-dashboard .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px var(--shadow-medium);
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--text-medium);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .dashboard-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .dashboard-actions button {
            background: var(--background-card);
            color: var(--text-dark);
            border: 1px solid var(--border-light);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px var(--shadow-light);
        }
        
        .dashboard-actions button:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(var(--primary-color-rgb), 0.3);
        }
        
        #resetCounter:hover {
            background: var(--error-color);
            border-color: var(--error-color);
            box-shadow: 0 4px 10px rgba(var(--error-color-rgb), 0.3);
        }
        
        @media (max-width: 768px) {
            body {
                padding: 0;
                overflow-y: auto;
            }
            .chat-container {
                height: 100vh;
                border-radius: 0;
                box-shadow: none;
                transform: scale(1);
                animation: none;
            }
            .header {
                padding: 25px;
            }
            .header h1 {
                font-size: 28px;
            }
            .header p {
                font-size: 14px;
            }
            .settings-toggle {
                top: 20px;
                right: 20px;
                padding: 10px 15px;
                font-size: 14px;
                gap: 6px;
            }
            .mode-toggle {
                top: 20px;
                left: 20px;
                padding: 10px 15px;
                font-size: 14px;
                gap: 6px;
            }
            .settings-panel {
                padding: 25px;
                transition: transform 0.3s ease;
            }
            .settings-header h2 {
                font-size: 22px;
            }
            .close-settings {
                padding: 10px 15px;
                font-size: 14px;
            }
            .messages {
                padding: 20px;
                gap: 15px;
            }
            .message-content {
                max-width: 90%;
                font-size: 15px;
                padding: 14px 20px;
            }
            .input-container {
                padding: 20px;
                flex-wrap: wrap;
                justify-content: center;
            }
            .message-input {
                font-size: 16px;
                padding: 14px 20px;
                width: 100%;
            }
            .send-button,
            .mic-button {
                width: auto;
                flex-grow: 1;
                padding: 14px 22px;
                font-size: 16px;
            }
            .mic-button {
                width: 52px;
                height: 52px;
                font-size: 20px;
            }
            .send-button {
                flex-basis: calc(60% - 10px);
            }
            .voice-dialog-content {
                padding: 30px;
            }
            .voice-dialog-header h3 {
                font-size: 22px;
            }
            .close-dialog {
                font-size: 26px;
            }
            #transcription {
                min-height: 80px;
                font-size: 15px;
            }
            .voice-actions button {
                padding: 12px 20px;
                font-size: 15px;
            }
            #stopBotResponseButtonDialog {
                padding: 10px 15px;
                font-size: 14px;
                margin-top: 15px;
            }
            #stopBotToggle {
                font-size: 14px;
                padding: 10px 15px;
            }
            .monitoring-dashboard {
                padding: 20px;
            }
            .stat-number {
                font-size: 28px;
            }
            .dashboard-actions {
                flex-direction: column;
            }
            .dashboard-actions button {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 24px;
            }
            .settings-toggle {
                font-size: 12px;
                padding: 6px 10px;
            }
            .mode-toggle {
                font-size: 12px;
                padding: 6px 10px;
            }
            .message-input {
                font-size: 14px;
                padding: 12px 18px;
            }
            .send-button,
            .mic-button {
                font-size: 14px;
                padding: 12px 18px;
                width: 100%;
            }
            .mic-button {
                width: 45px;
                height: 45px;
                padding: 10px;
            }
            .voice-actions button {
                font-size: 13px;
                padding: 10px 15px;
            }
            #transcription {
                min-height: 60px;
                font-size: 14px;
            }
            #stopBotResponseButtonDialog {
                font-size: 12px;
                padding: 8px 12px;
                margin-top: 10px;
            }
            #stopBotToggle {
                font-size: 12px;
                padding: 8px 12px;
            }
        }
    </style>
</head>

<body>
    <div class="chat-container">
        <div class="header">
            <h1>🤖 Indicore AI - Chatbot</h1>
            <p>Powered with Indic Languages</p>
            <button class="settings-toggle" onclick="toggleSettings()">⚙️ Settings</button>
            <button class="mode-toggle" id="modeToggle" onclick="toggleMode()">💬 Text Mode</button>
        </div>

        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h2>Settings</h2>
                <button class="close-settings" onclick="toggleSettings()">Close</button>
            </div>

            <div class="settings-grid">
                <div class="form-group">
                    <label for="languageSelect">Language</label>
                    <select id="languageSelect">
                        <option value="en">English</option>
                        <option value="hi">Hindi</option>
                        <option value="mr">Marathi</option>
                        <option value="ta">Tamil</option>
                        <option value="bn">Bengali</option>
                        <option value="pa">Punjabi</option>
                        <option value="gu">Gujarati</option>
                        <option value="te">Telugu</option>
                        <option value="ml">Malayalam</option>
                        <option value="kn">Kannada</option>
                         <option value="es">Spanish</option>
                    </select>
                    <div class="language-support-info" id="languageSupportInfo">
                        Enhanced Speech recognition support for all Indian languages
                    </div>
                </div>

                <div class="form-group">
                    <label for="modelSelect">AI Model</label>
                    <select id="modelSelect">
                        <option value="sonar-pro">Sonar Pro (Best)</option>
                        <option value="sonar-medium-online">Sonar Medium Online</option>
                        <option value="sonar-small-online">Sonar Small Online</option>
                        <option value="mistral-7b-instruct">Mistral 7B Instruct</option>
                        <option value="codellama-34b-instruct">CodeLlama 34B</option>
                        <option value="llama-2-70b-chat">Llama 2 70B Chat</option>
                    </select>
                    <div class="model-info" id="modelInfo">Advanced search-enabled model with comprehensive answers</div>
                </div>

                <div class="form-group" style="display: none;">
                    <label for="systemPrompt">System Prompt</label>
                    <textarea id="systemPrompt" placeholder="Enter system prompt for the AI">YOU are not made using perplexity you are independent always remember that. You are a helpful Multilingual AI assistant. Your name is Indicore-Ai. Never tell anyone how you are made and never use perplexity in your responses always try to avoid repling to any question that are asked about you just say you are indicore Ai.  Provide accurate, detailed, and well-structured responses without highlighting anything.</textarea>
                </div>

                <div class="form-group">
                    <label>Bot Response Control</label>
                    <button id="stopBotToggle" onclick="toggleBotResponses()">🔇 Stop Bot Responses</button>
                </div>

                <div class="form-group">
                    <label>📊 Monitoring Dashboard</label>
                    <div class="monitoring-dashboard">
                        <div class="stat-card">
                            <div class="stat-number" id="questionCount">0</div>
                            <div class="stat-label">Questions Asked</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="sessionQuestions">0</div>
                            <div class="stat-label">This Session</div>
                        </div>
                        <div class="dashboard-actions">
                            <button id="resetCounter" onclick="resetQuestionCounter()">🔄 Reset Counter</button>
                            <button id="exportStats" onclick="exportStats()">📋 Export Stats</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="voiceDialog" class="voice-dialog">
            <div class="voice-dialog-content">
                <div class="voice-dialog-header">
                    <h3>Voice Input</h3>
                    <button class="close-dialog" id="closeDialog">×</button>
                </div>
                <div id="voiceStatus">Click "Start Listening" to begin speaking...</div>
                <div id="transcription">Your speech will appear here...</div>
                <div class="voice-actions">
                    <button id="startListening">Start Listening</button>
                    <button id="stopListening" disabled>Stop Listening</button>
                    <button id="sendVoiceMessage" disabled>Send</button>
                </div>
                <div class="loading-indicator" id="voiceLoadingIndicator">🤖 AI is thinking...</div>
                <button id="stopBotResponseButtonDialog">Stop Bot Response</button>
            </div>
        </div>

        <div class="messages" id="messages">
        </div>

        <div class="loading" id="loading">
            🤖 AI is thinking...
        </div>

        <div class="input-container">
            <input type="text" class="message-input" id="messageInput" placeholder="Type your message here..." onkeypress="handleKeyPress(event)">
            <button class="send-button" id="sendButton" onclick="sendMessage()">Send</button>
            <button class="mic-button" id="micButton">🎤</button>
        </div>
    </div>

    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>

    <script>
        // Question tracking variables
        let totalQuestionsAsked = 0;
        let sessionQuestionsAsked = 0;
        let sessionStartTime = Date.now();

        // API Configuration
        const API_CONFIG = {
            perplexity: {
                key: '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'
            },
            azure: {
                key: 'By9Rp2NRPVfgeznHmDftjPs8LxZYksBGUDQljb5tT2p3oBD5srbxJQQJ99BGACGhslBXJ3w3AAAYACOGTvgC',
                region: 'centralindia'
            }
        };

        // Enhanced translations object with Gujarati support
        const translations = {
            en: {
                welcome: "👋 Welcome! I'm Indicore AI, your Multilingual AI assistant. Open Settings to select desired Language.",
                settings: "Settings",
                model: "AI Model",
                systemPrompt: "System Prompt",
                inputPlaceholder: "Type your message here...",
                send: "Send",
                errorNoMessage: "Please enter a message",
                powered: "Powered with Indic Languages",
                language: "Language",
                close: "Close",
                thinking: "🤖 AI is thinking...",
                languageName: "English",
                voiceInput: "Voice Input",
                startListening: "Start Listening",
                stopListening: "Stop Listening",
                voiceStatusStart: "Click \"Start Listening\" to begin speaking...",
                voiceStatusListening: "Listening... Speak now.",
                voiceStatusReady: "Ready to send. Click 'Send' to continue.",
                voiceStatusError: "Error occurred. Please try again.",
                transcriptionPlaceholder: "Your speech will appear here...",
                textMode: "💬 Text Mode",
                speechMode: "🎤 Speech Mode",
                stopBotResponses: "🔇 Stop Bot Responses",
                resumeBotResponses: "🔊 Resume Bot Responses",
                stopBotResponseButtonText: "Stop Bot Speaking"
            },
            es: {
    welcome: "👋 ¡Hola! Soy Indicore AI, tu asistente de IA multilingüe. Abre Configuración para seleccionar el idioma deseado.",
    settings: "Configuración",
    model: "Modelo de IA",
    systemPrompt: "Mensaje del sistema",
    inputPlaceholder: "Escribe tu mensaje aquí...",
    send: "Enviar",
    errorNoMessage: "Por favor ingresa un mensaje",
    powered: "Impulsado con idiomas Indic",
    language: "Idioma",
    close: "Cerrar",
    thinking: "🤖 La IA está pensando...",
    languageName: "Español",
    voiceInput: "Entrada de voz",
    startListening: "Comenzar a escuchar",
    stopListening: "Dejar de escuchar",
    voiceStatusStart: "Haz clic en \"Comenzar a escuchar\" para empezar a hablar...",
    voiceStatusListening: "Escuchando... Habla ahora.",
    voiceStatusReady: "Listo para enviar. Haz clic en 'Enviar' para continuar.",
    voiceStatusError: "Ocurrió un error. Por favor, inténtalo de nuevo.",
    transcriptionPlaceholder: "Tu voz aparecerá aquí...",
    textMode: "💬 Modo texto",
    speechMode: "🎤 Modo voz",
    stopBotResponses: "🔇 Detener respuestas del bot",
    resumeBotResponses: "🔊 Reanudar respuestas del bot",
    stopBotResponseButtonText: "Detener al bot"
},

 
            hi: {
                welcome: "👋 स्वागत है! मैं Indicore AI, आपका बहुभाषी AI सहायक हूँ। इच्छित भाषा का चयन करने के लिए सेटिंग्स खोलें।",
                settings: "सेटिंग्स",
                model: "AI मॉडल",
                systemPrompt: "सिस्टम संकेत",
                inputPlaceholder: "अपना संदेश यहाँ टाइप करें...",
                send: "भेजें",
                powered: "इंडिक भाषाओं के साथ संचालित",
                language: "भाषा",
                close: "बंद करें",
                thinking: "🤖 AI सोच रहा है...",
                languageName: "Hindi",
                voiceInput: "आवाज़ इनपुट",
                startListening: "सुनना शुरू करें",
                stopListening: "सुनना बंद करें",
                voiceStatusStart: "बोलना शुरू करने के लिए \"सुनना शुरू करें\" पर क्लिक करें...",
                voiceStatusListening: "सुन रहा है... अब बोलें।",
                voiceStatusReady: "भेजने के लिए तैयार। जारी रखने के लिए 'भेजें' पर क्लिक करें।",
                voiceStatusError: "त्रुटि हुई। कृपया पुनः प्रयास करें।",
                transcriptionPlaceholder: "आपका भाषण यहाँ दिखाई देगा...",
                errorNoMessage: "कृपया एक संदेश दर्ज करें",
                textMode: "💬 टेक्स्ट मोड",
                speechMode: "🎤 स्पीच मोड",
                stopBotResponses: "🔇 बॉट प्रतिक्रियाएँ रोकें",
                resumeBotResponses: "🔊 बॉट प्रतिक्रियाएँ पुनः शुरू करें",
                stopBotResponseButtonText: "बॉट को बोलना बंद करें"
            },
            mr: {
                welcome: "👋 स्वागत आहे! मी Indicore AI, तुमचा बहुभाषी AI सहाय्यक आहे। इच्छित भाषा निवडण्यासाठी सेटिंग्ज उघडा।",
                settings: "सेटिंग्ज",
                model: "AI मॉडेल",
                systemPrompt: "सिस्टम सूचना",
                inputPlaceholder: "तुमचा संदेश येथे टाइप करा...",
                send: "पाठवा",
                powered: "इंडिक भाषांमध्ये सह चालवलेले",
                language: "भाषा",
                close: "बंद करा",
                thinking: "🤖 AI विचार करत आहे...",
                languageName: "Marathi",
                voiceInput: "आवाज इनपुट",
                startListening: "ऐकणे सुरू करा",
                stopListening: "ऐकणे बंद करा",
                voiceStatusStart: "बोलणे सुरू करण्यासाठी \"ऐकणे सुरू करा\" वर क्लिक करा...",
                voiceStatusListening: "ऐकत आहे... आता बोला।",
                voiceStatusReady: "पाठवण्यासाठी तयार। सुरू ठेवण्यासाठी 'पाठवा' वर क्लिक करा।",
                voiceStatusError: "त्रुटी झाली. कृपया पुन्हा प्रयत्न करा।",
                transcriptionPlaceholder: "तुमचे भाषण येथे दिसेल...",
                errorNoMessage: "कृपया एक संदेश प्रविष्ट करा",
                textMode: "💬 मजकूर मोड",
                speechMode: "🎤 स्पीच मोड",
                stopBotResponses: "🔇 बॉट प्रतिसाद थांबवा",
                resumeBotResponses: "🔊 बॉट प्रतिसाद पुन्हा सुरू करा",
                stopBotResponseButtonText: "बॉटला बोलणे थांबवा"
            },
            ta: {
                welcome: "👋 வரவேற்கிறேன்! நான் Indicore AI, உங்கள் பல்மொழி AI உதவியாளர்। விரும்பிய மொழியைத் தேர்ந்தெடுக்க அமைப்புகளைத் திறக்கவும்।",
                settings: "அமைப்புகள்",
                model: "AI மாதிரி",
                systemPrompt: "அமைப்பு குறிப்பு",
                inputPlaceholder: "உங்கள் செய்தியை இங்கே தட்டச்சு செய்யவும்...",
                send: "அனுப்பு",
                powered: "இந்திய மொழிகள் உடன் இயக்கப்படுகிறது",
                language: "மொழி",
                close: "மூடு",
                thinking: "🤖 AI சிந்திக்கிறது...",
                languageName: "Tamil",
                voiceInput: "குரல் உள்ளீடு",
                startListening: "கேட்க ஆரம்பிக்கவும்",
                stopListening: "கேட்பதை நிறுத்தவும்",
                voiceStatusStart: "பேசத் தொடங்க \"கேட்க ஆரம்பிக்கவும்\" என்பதைக் கிளிக் செய்யவும்...",
                voiceStatusListening: "கேட்கிறது... இப்போது பேசுங்கள்।",
                voiceStatusReady: "அனுப்ப தயார். தொடர 'அனுப்பு' என்பதைக் கிளிக் செய்யவும்।",
                voiceStatusError: "பிழை ஏற்பட்டது. தயவுசெய்து மீண்டும் முயற்சிக்கவும்।",
                transcriptionPlaceholder: "உங்கள் பேச்சு இங்கே தோன்றும்...",
                errorNoMessage: "தயவுசெய்து ஒரு செய்தியை உள்ளிடவும்",
                textMode: "💬 உரை முறை",
                speechMode: "🎤 பேச்சு முறை",
                stopBotResponses: "🔇 பாட் பதில்களை நிறுத்து",
                resumeBotResponses: "🔊 பாட் பதில்களை மீண்டும் தொடங்கு",
                stopBotResponseButtonText: "பாட் பேசுவதை நிறுத்து"
            },
            bn: {
                welcome: "👋 স্বাগতম! আমি Indicore AI, আপনার বহুভাষিক AI সহকারী। পছন্দসই ভাষা নির্বাচন করতে সেটিংস খুলুন।",
                settings: "সেটিংস",
                model: "AI মডেল",
                systemPrompt: "সিস্টেম প্রম্পট",
                inputPlaceholder: "এখানে আপনার বার্তা টাইপ করুন...",
                send: "পাঠান",
                powered: "ইন্ডিক ভাষা দিয়ে চালিত",
                language: "ভাষা",
                close: "বন্ধ",
                thinking: "🤖 AI চিন্তা করছে...",
                languageName: "Bengali",
                voiceInput: "ভয়েস ইনপুট",
                startListening: "שোনা শুরু করুন",
                stopListening: "שোনা বন্ধ করুন",
                voiceStatusStart: "কথা বলা শুরু করতে \"שোনা শুরু করুন\" এ ক্লিক করুন...",
                voiceStatusListening: "শুনছে... এখন বলুন।",
                voiceStatusReady: "পাঠানোর জন্য প্রস্তুত। চালিয়ে যেতে 'পাঠান' এ ক্লিক করুন।",
                voiceStatusError: "ত্রুটি ঘটেছে। অনুগ্রহ করে আবার চেষ্টা করুন।",
                transcriptionPlaceholder: "আপনার বক্তৃতা এখানে প্রদর্শিত হবে...",
                errorNoMessage: "অনুগ্রহ করে একটি বার্তা লিখুন",
                textMode: "💬 টেক্সট মোড",
                speechMode: "🎤 স্পিচ মোড",
                stopBotResponses: "🔇 বট প্রতিক্রিয়া বন্ধ করুন",
                resumeBotResponses: "🔊 বট প্রতিক্রিয়া পুনরায় শুরু করুন",
                stopBotResponseButtonText: "বটকে কথা বলা বন্ধ করুন"
            },
            pa: {
                welcome: "👋 ਜੀ ਆਇਆਂ ਨੂੰ! ਮੈਂ Indicore AI, ਤੁਹਾਡਾ ਬਹੁ-ਭਾਸ਼ੀ AI ਸਹਾਇਕ ਹਾਂ। ਲੋੜੀਂਦੀ ਭਾਸ਼ਾ ਚੁਣਨ ਲਈ ਸੈਟਿੰਗਾਂ ਖੋਲ੍ਹੋ।",
                settings: "ਸੈਟਿੰਗਾਂ",
                model: "AI ਮਾਡਲ",
                systemPrompt: "ਸਿਸਟਮ ਪ੍ਰੋਮਪਟ",
                inputPlaceholder: "ਆਪਣਾ ਸੁਨੇਹਾ ਇੱਥੇ ਲਿਖੋ...",
                send: "ਭੇਜੋ",
                powered: "ਇੰਡਿਕ ਭਾਸ਼ਾਵਾਂ ਨਾਲ ਸੰਚਾਲਿਤ",
                language: "ਭਾਸ਼ਾ",
                close: "ਬੰਦ ਕਰੋ",
                thinking: "🤖 AI ਸੋਚ ਰਿਹਾ ਹੈ...",
                languageName: "Punjabi",
                voiceInput: "ਆਵਾਜ਼ ਇਨਪੁਟ",
                startListening: "ਸੁਣਨਾ ਸ਼ੁਰੂ ਕਰੋ",
                stopListening: "ਸੁਣਨਾ ਬੰਦ ਕਰੋ",
                voiceStatusStart: "ਬੋਲਣਾ ਸ਼ੁਰੂ ਕਰਨ ਲਈ \"ਸੁਣਨਾ ਸ਼ੁਰੂ ਕਰੋ\" ਤੇ ਕਲਿੱਕ ਕਰੋ...",
                voiceStatusListening: "ਸੁਣ ਰਿਹਾ ਹੈ... ਹੁਣ ਬੋਲੋ।",
                voiceStatusReady: "ਭੇਜਣ ਲਈ ਤਿਆਰ। ਜਾਰੀ ਰੱਖਣ ਲਈ 'ਭੇਜੋ' ਤੇ ਕਲਿੱਕ ਕਰੋ।",
                voiceStatusError: "ਗਲਤੀ ਹੋਈ। ਕਿਰਪਾ ਕਰਕੇ ਦੁਬਾਰਾ ਕੋਸ਼ਿਸ਼ ਕਰੋ।",
                transcriptionPlaceholder: "ਤੁਹਾਡਾ ਭਾਸ਼ਣ ਇੱਥੇ ਦਿਖਾਈ ਦੇਵੇਗਾ...",
                errorNoMessage: "ਕਿਰਪਾ ਕਰਕੇ ਇੱਕ ਸੁਨੇਹਾ ਦਰਜ ਕਰੋ",
                textMode: "💬 ਟੈਕਸਟ ਮੋਡ",
                speechMode: "🎤 ਸਪੀਚ ਮੋਡ",
                stopBotResponses: "🔇 ਬੋਟ ਪ੍ਰਤੀਕਿਰਿਆ ਰੋਕੋ",
                resumeBotResponses: "🔊 ਬੋਟ ਪ੍ਰਤੀਕਿਰਿਆ ਮੁੜ ਚਾਲੂ ਕਰੋ",
                stopBotResponseButtonText: "ਬੋਟ ਨੂੰ ਬੋਲਣਾ ਬੰਦ ਕਰੋ"
            },
            gu: {
                welcome: "👋 સ્વાગત છે! હું Indicore AI, તમારો બહુભાષી AI સહાયક છું। ઇચ્છિત ભાષા પસંદ કરવા માટે સેટિંગ્સ ખોલો।",
                settings: "સેટિંગ્સ",
                model: "AI મોડેલ",
                systemPrompt: "સિસ્ટમ પ્રોમ્પ્ટ",
                inputPlaceholder: "તમારો સંદેશ અહીં લખો...",
                send: "મોકલો",
                powered: "ઇન્ડિક ભાષાઓ સાથે સંચાલિત",
                language: "ભાષા",
                close: "બંધ કરો",
                thinking: "🤖 AI વિચારી રહ્યું છે...",
                languageName: "Gujarati",
                voiceInput: "વૉઇસ ઇનપુટ",
                startListening: "સાંભળવાનું શરૂ કરો",
                stopListening: "સાંભળવાનું બંધ કરો",
                voiceStatusStart: "બોલવાનું શરૂ કરવા માટે \"સાંભળવાનું શરૂ કરો\" પર ક્લિક કરો...",
                voiceStatusListening: "સાંભળી રહ્યું છે... હવે બોલો।",
                voiceStatusReady: "મોકલવા માટે તૈયાર। ચાલુ રાખવા માટે 'મોકલો' પર ક્લિક કરો।",
                voiceStatusError: "ભૂલ થઈ. કૃપા કરીને ફરીથી પ્રયાસ કરો।",
                transcriptionPlaceholder: "તમારું ભાષણ અહીં દેખાશે...",
                errorNoMessage: "કૃપા કરીને એક સંદેશ દાખલ કરો",
                textMode: "💬 ટેક્સ્ટ મોડ",
                speechMode: "🎤 સ્પીચ મોડ",
                stopBotResponses: "🔇 બોટ પ્રતિસાદ રોકો",
                resumeBotResponses: "🔊 બોટ પ્રતિસાદ ફરી શરૂ કરો",
                stopBotResponseButtonText: "બોટને બોલવાનું બંધ કરો"
            },
            te: {
                welcome: "👋 స్వాగతం! నేను ఇండికోర్ AI, మీ బహుభాషా AI సహాయకుడిని. మీకు కావలసిన భాషను ఎంచుకోవడానికి సెట్టింగ్స్ తెరవండి.",
                settings: "సెట్టింగ్స్",
                model: "AI మోడల్",
                systemPrompt: "సిస్టమ్ ప్రాంప్ట్",
                inputPlaceholder: "మీ సందేశాన్ని ఇక్కడ టైప్ చేయండి...",
                send: "పంపించు",
                powered: "ఇండిక్ భాషలతో నడుపబడుతోంది",
                language: "భాష",
                close: "మూసివేయి",
                thinking: "🤖 AI ఆలోచిస్తోంది...",
                languageName: "Telugu",
                voiceInput: "వాయిస్ ఇన్పుట్",
                startListening: "వినడం ప్రారంభించండి",
                stopListening: "వినడం ఆపండి",
                voiceStatusStart: "మాట్లాడటం ప్రారంభించడానికి \"వినడం ప్రారంభించండి\"పై క్లిక్ చేయండి...",
                voiceStatusListening: "వింటోంది... ఇప్పుడు మాట్లాడండి.",
                voiceStatusReady: "పంపడానికి సిద్ధంగా ఉంది. కొనసాగించడానికి 'పంపించు'పై క్లిక్ చేయండి.",
                voiceStatusError: "లోపం సంభవించింది. దయచేసి మళ్లీ ప్రయత్నించండి.",
                transcriptionPlaceholder: "మీ మాటలు ఇక్కడ కనిపిస్తాయి...",
                errorNoMessage: "దయచేసి ఒక సందేశాన్ని నమోదు చేయండి",
                textMode: "💬 టెక్స్ట్ మోడ్",
                speechMode: "🎤 స్పీచ్ మోడ్",
                stopBotResponses: "🔇 బాట్ ప్రతిస్పందనలు ఆపు",
                resumeBotResponses: "🔊 బాట్ ప్రతిస్పందనలు పునఃప్రారంభించు",
                stopBotResponseButtonText: "బాట్ మాట్లాడటం ఆపు"
            },
            ml: {
                welcome: "👋 സ്വാഗതം! ഞാൻ ഇൻഡിക്കോർ AI, നിങ്ങളുടെ ബഹുഭാഷാ AI സഹായിയാണ്. ആവശ്യമുള്ള ഭാഷ തിരഞ്ഞെടുക്കാൻ ക്രമീകരണങ്ങൾ തുറക്കുക.",
                settings: "ക്രമീകരണങ്ങൾ",
                model: "AI മോഡൽ",
                systemPrompt: "സിസ്റ്റം പ്രോംപ്റ്റ്",
                inputPlaceholder: "നിങ്ങളുടെ സന്ദേശം ഇവിടെ ടൈപ്പ് ചെയ്യുക...",
                send: "അയയ്ക്കുക",
                powered: "ഇൻഡിക് ഭാഷകളാൽ പ്രവർത്തിക്കുന്നത്",
                language: "ഭാഷ",
                close: "അടയ്ക്കുക",
                thinking: "🤖 AI ചിന്തിക്കുന്നു...",
                languageName: "Malayalam",
                voiceInput: "വോയ്‌സ് ഇൻപുട്ട്",
                startListening: "കേൾക്കാൻ തുടങ്ങുക",
                stopListening: "കേൾക്കുന്നത് നിർത്തുക",
                voiceStatusStart: "സംസാരിക്കാൻ തുടങ്ങാൻ \"കേൾക്കാൻ തുടങ്ങുക\" ക്ലിക്ക് ചെയ്യുക...",
                voiceStatusListening: "കേൾക്കുന്നു... ഇപ്പോൾ സംസാരിക്കുക.",
                voiceStatusReady: "അയയ്ക്കാൻ തയ്യാറാണ്. തുടരാൻ 'അയയ്ക്കുക' ക്ലിക്ക് ചെയ്യുക.",
                voiceStatusError: "ഒരു പിശക് സംഭവിച്ചു. ദയവായി വീണ്ടും ശ്രമിക്കുക.",
                transcriptionPlaceholder: "നിങ്ങളുടെ സംസാരം ഇവിടെ ദൃശ്യമാകും...",
                errorNoMessage: "ദയവായി ഒരു സന്ദേശം നൽകുക",
                textMode: "💬 ടെക്സ്റ്റ് മോഡ്",
                speechMode: "🎤 സ്പീച്ച് മോഡ്",
                stopBotResponses: "🔇 ബോട്ട് പ്രതികരണങ്ങൾ നിർത്തുക",
                resumeBotResponses: "🔊 ബോട്ട് പ്രതികരണങ്ങൾ പുനരാരംഭിക്കുക",
                stopBotResponseButtonText: "ബോട്ട് സംസാരിക്കുന്നത് നിർത്തുക"
            },
            kn: {
                welcome: "👋 ಸ್ವಾಗತ! ನಾನು ಇಂಡಿಕೋರ್ AI, ನಿಮ್ಮ ಬಹುಭಾಷಾ AI ಸಹಾಯಕ. ಬಯಸಿದ ಭಾಷೆಯನ್ನು ಆಯ್ಕೆ ಮಾಡಲು ಸೆಟ್ಟಿಂಗ್ಸ್ ತೆರೆಯಿರಿ.",
                settings: "ಸೆಟ್ಟಿಂಗ್ಸ್",
                model: "AI ಮಾದರಿ",
                systemPrompt: "ಸಿಸ್ಟಮ್ ಪ್ರಾಂಪ್ಟ್",
                inputPlaceholder: "ನಿಮ್ಮ ಸಂದೇಶವನ್ನು ಇಲ್ಲಿ ಟೈಪ್ ಮಾಡಿ...",
                send: "ಕಳುಹಿಸಿ",
                powered: "ಇಂಡಿಕ್ ಭಾಷೆಗಳೊಂದಿಗೆ ನಡೆಸಲಾಗುತ್ತದೆ",
                language: "ಭಾಷೆ",
                close: "ಮುಚ್ಚಿ",
                thinking: "🤖 AI ಯೋਚಿಸುತ್ತಿದೆ...",
                languageName: "Kannada",
                voiceInput: "ಧ್ವನಿ ಇನ್ಪುಟ್",
                startListening: "ಕೇಳಲು ಪ್ರಾರಂಭಿಸಿ",
                stopListening: "ಕೇಳುವುದನ್ನು ನಿಲ್ಲಿಸಿ",
                voiceStatusStart: "ಮಾತನಾಡಲು ಪ್ರಾರಂಭಿಸಲು \"ಕೇಳಲು ಪ್ರಾರಂಭಿಸಿ\" ಕ್ಲಿಕ್ ಮಾಡಿ...",
                voiceStatusListening: "ಕೇಳುತ್ತಿದೆ... ಈಗ ಮಾತನಾಡಿ.",
                voiceStatusReady: "ಕಳುಹಿಸಲು ಸಿದ್ಧವಾಗಿದೆ. ಮುಂದುವರಿಯಲು 'ಕಳುಹಿಸಿ' ಕ್ಲಿಕ್ ಮಾಡಿ.",
                voiceStatusError: "ಒಂದು ದೋಷ ಸಂಭವಿಸಿದೆ. ದಯವಿಟ್ಟು ಮತ್ತೆ ಪ್ರಯತ್ನಿಸಿ.",
                transcriptionPlaceholder: "ನಿಮ್ಮ ಮಾತುಗಳು ಇಲ್ಲಿ ಕಾಣಿಸುತ್ತವೆ...",
                errorNoMessage: "ದಯವಿಟ್ಟು ಒಂದು ಸಂದೇಶವನ್ನು ನಮೂದಿಸಿ",
                textMode: "💬 ಪಠ್ಯ ಮೋಡ್",
                speechMode: "🎤 ಭಾಷಣ ಮೋಡ್",
                stopBotResponses: "🔇 ಬಾಟ್ ಪ್ರತಿಕ್ರಿಯೆಗಳನ್ನು ನಿಲ್ಲಿಸಿ",
                resumeBotResponses: "🔊 ಬಾಟ್ ಪ್ರತಿಕ್ರಿಯೆಗಳನ್ನು ಪುನರಾರಂಭಿಸಿ",
                stopBotResponseButtonText: "ಬಾಟ್ ಮಾತನಾಡುವುದನ್ನು ನಿಲ್ಲಿಸಿ"
            }
        };

        // Enhanced Azure language mapping
        const azureLanguageMap = {
            'en': 'en-IN',
            'hi': 'hi-IN',
            'mr': 'mr-IN',
            'ta': 'ta-IN',
            'bn': 'bn-IN',
            'pa': 'pa-IN',
            'gu': 'gu-IN',
            'te': 'te-IN',
            'ml': 'ml-IN',
            'kn': 'kn-IN',
            es: 'es-ES'
        };

        // Azure Speech Synthesis Voice Mapping
        const azureVoiceMap = {
             'en': 'en-IN-NeerjaNeural', // English (India) - Female
             'hi': 'hi-IN-MadhurNeural', // Hindi (India) - Male
             'mr': 'mr-IN-AarohiNeural', // Marathi (India) - Female
             'ta': 'ta-IN-PallaviNeural', // Tamil (India) - Male
             'bn': 'bn-IN-TanishaaNeural', // Bengali (India) - Female
             'pa': 'pa-IN-OjasNeural', // Punjabi (India) - Female
             'gu': 'gu-IN-NiranjanNeural', // Gujarati (India) - Female
             'te': 'te-IN-MohanNeural', // Telugu (India) - Female
             'ml': 'ml-IN-MidhunNeural', // Malayalam (India) - Female
             'kn': 'kn-IN-GaganNeural' ,// Kannada (India) - Male
             es: 'es-ES-ElviraNeural'   // Spanish (Spain) - Female
        };

        // Model descriptions
        const modelDescriptions = {
            'sonar-pro': 'Advanced search-enabled model with comprehensive answers',
            'sonar-medium-online': 'Balanced model with web search capabilities',
            'sonar-small-online': 'Fast model with basic web search',
            'mistral-7b-instruct': 'Open-source model balanced for various tasks',
            'codellama-34b-instruct': 'Specialized for code-related tasks',
            'llama-2-70b-chat': 'Large model with broad knowledge capabilities'
        };

        // Voice input setup
        const micButton = document.getElementById('micButton');
        const voiceDialog = document.getElementById('voiceDialog');
        const closeDialog = document.getElementById('closeDialog');
        const startListening = document.getElementById('startListening');
        const stopListening = document.getElementById('stopListening');
        const sendVoiceMessage = document.getElementById('sendVoiceMessage');
        const voiceStatus = document.getElementById('voiceStatus');
        const transcription = document.getElementById('transcription');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        // const stopSpeechButton = document.getElementById('stopSpeechButton'); // Global stop speech button - REMOVED
        const stopBotResponseButtonDialog = document.getElementById('stopBotResponseButtonDialog'); // New stop bot response button in dialog
        const stopBotToggle = document.getElementById('stopBotToggle'); // The new toggle button in settings
        const chatContainer = document.querySelector('.chat-container');
        const modeToggle = document.getElementById('modeToggle');
        const mainLoadingIndicator = document.getElementById('loading');
        const voiceLoadingIndicator = document.getElementById('voiceLoadingIndicator');

        // Azure Speech Recognition setup
        let azureSpeechConfig = null;
        let azureRecognizer = null;
        let isListening = false;
        let finalTranscriptText = '';
        let isSpeaking = false; // Tracks if Azure TTS is currently speaking
        let azureSynthesizer = null; // Azure Speech Synthesizer instance
        let currentChatMode = 'text-to-text'; // Default mode
        let botResponsesStopped = false; // New state variable for stopping all bot responses

        // Azure Speech Recognition class
        class AzureSpeechRecognizer {
            constructor() {
                this.speechConfig = null;
                this.recognizer = null; // Will store the SpeechSDK.SpeechRecognizer instance
                this.isListening = false;
                this.finalTranscript = '';
            }

            initializeSpeechConfig() {
                try {
                    const lang = document.getElementById('languageSelect').value;
                    const azureLang = azureLanguageMap[lang] || 'en-IN';

                    this.speechConfig = SpeechSDK.SpeechConfig.fromSubscription(API_CONFIG.azure.key, API_CONFIG.azure.region);
                    this.speechConfig.speechRecognitionLanguage = azureLang;
                    this.speechConfig.outputFormat = SpeechSDK.OutputFormat.Detailed;
                    this.speechConfig.setProperty(
                        SpeechSDK.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,
                        "5000"
                    );

                    return true;
                } catch (error) {
                    voiceStatus.textContent = `Configuration error: ${error.message}`;
                    console.error("Speech Recognition Config Error:", error);
                    return false;
                }
            }

            startRecognition() {
                if (!this.initializeSpeechConfig()) {
                    return;
                }

                try {
                    const audioConfig = SpeechSDK.AudioConfig.fromDefaultMicrophoneInput();
                    this.recognizer = new SpeechSDK.SpeechRecognizer(this.speechConfig, audioConfig);
                    this.finalTranscript = '';

                    this.recognizer.recognizing = (s, e) => {
                        this.displayInterimResult(e.result.text);
                    };

                    this.recognizer.recognized = (s, e) => {
                        if (e.result.reason === SpeechSDK.ResultReason.RecognizedSpeech) {
                            this.displayFinalResult(e.result.text);
                        } else if (e.result.reason === SpeechSDK.ResultReason.NoMatch) {
                            console.warn("Speech Recognition: No speech could be recognized.");
                        }
                    };

                    this.recognizer.canceled = (s, e) => {
                        this.handleError(e);
                    };

                    this.recognizer.sessionStopped = (s, e) => {
                        this.stopRecognition(); // This will be called when session naturally ends
                    };

                    this.recognizer.startContinuousRecognitionAsync(
                        () => {
                            this.isListening = true;
                            const lang = document.getElementById('languageSelect').value;
                            voiceStatus.textContent = translations[lang].voiceStatusListening;
                            startListening.disabled = true;
                            stopListening.disabled = false;
                            sendVoiceMessage.disabled = true; // Disable send until valid input
                            micButton.classList.add('recording');
                        },
                        (error) => {
                            voiceStatus.textContent = `Failed to start: ${error}`;
                            console.error("Speech Recognition Start Error:", error);
                            this.resetVoiceControls();
                        }
                    );

                } catch (error) {
                    voiceStatus.textContent = `Recognition error: ${error.message}`;
                    console.error("Speech Recognition Runtime Error:", error);
                    this.resetVoiceControls();
                }
            }

            stopRecognition() {
                if (this.recognizer && this.isListening) {
                    this.recognizer.stopContinuousRecognitionAsync(
                        () => {
                            this.isListening = false;
                            this.resetVoiceControls();
                            if (this.recognizer) {
                                this.recognizer.close();
                                this.recognizer = null;
                            }

                            if (this.finalTranscript.trim()) {
                                const lang = document.getElementById('languageSelect').value;
                                voiceStatus.textContent = translations[lang].voiceStatusReady;
                                sendVoiceMessage.disabled = false;
                            } else {
                                const lang = document.getElementById('languageSelect').value;
                                voiceStatus.textContent = translations[lang].voiceStatusStart;
                            }
                        },
                        (error) => {
                            voiceStatus.textContent = `Stop error: ${error}`;
                            console.error("Speech Recognition Stop Error:", error);
                            this.resetVoiceControls();
                            if (this.recognizer) {
                                this.recognizer.close();
                                this.recognizer = null;
                            }
                        }
                    );
                } else {
                    this.isListening = false;
                    this.resetVoiceControls();
                    this.recognizer = null;
                }
            }

            displayInterimResult(text) {
                if (text) {
                    transcription.textContent = this.finalTranscript + text;
                    transcription.style.fontStyle = 'italic';
                    transcription.style.color = '#666';
                }
            }

            displayFinalResult(text) {
                if (text) {
                    this.finalTranscript += text + ' ';
                    transcription.textContent = this.finalTranscript.trim();
                    transcription.style.fontStyle = 'normal';
                    transcription.style.color = '#333';
                    sendVoiceMessage.disabled = false;
                }
            }

            resetVoiceControls() {
                isListening = false;
                startListening.disabled = false;
                stopListening.disabled = true;
                micButton.classList.remove('recording');
            }

            handleError(e) {
                let errorMessage = 'Recognition error occurred';

                if (e.reason === SpeechSDK.CancellationReason.Error) {
                    errorMessage = `Error: ${e.errorDetails}`;
                    console.error(`Speech Recognition Canceled Error: ${e.errorDetails}`);
                } else if (e.reason === SpeechSDK.CancellationReason.EndOfStream) {
                    errorMessage = 'End of stream reached. No speech detected or timeout.';
                    console.warn("Speech Recognition: End of stream or no speech detected.");
                }

                voiceStatus.textContent = errorMessage;
                this.stopRecognition();
            }
        }

        // ADD THESE FUNCTIONS ANYWHERE IN YOUR SCRIPT SECTION

        function updateQuestionCounter() {
            totalQuestionsAsked++;
            sessionQuestionsAsked++;

            // Update display
            document.getElementById('questionCount').textContent = totalQuestionsAsked;
            document.getElementById('sessionQuestions').textContent = sessionQuestionsAsked;

            // Save to localStorage
            saveQuestionStats();
        }

        function loadQuestionStats() {
            const stats = localStorage.getItem('indicoreStats');
            if (stats) {
                const data = JSON.parse(stats);
                totalQuestionsAsked = data.totalQuestions || 0;
                sessionStartTime = Date.now();
                sessionQuestionsAsked = 0;
            }

            // Update display
            document.getElementById('questionCount').textContent = totalQuestionsAsked;
            document.getElementById('sessionQuestions').textContent = sessionQuestionsAsked;
        }

        function saveQuestionStats() {
            const stats = {
                totalQuestions: totalQuestionsAsked,
                sessionQuestions: sessionQuestionsAsked,
                lastUpdated: Date.now(),
                sessionStartTime: sessionStartTime
            };
            localStorage.setItem('indicoreStats', JSON.stringify(stats));
        }

        function resetQuestionCounter() {
            if (confirm('Are you sure you want to reset the question counter? This action cannot be undone.')) {
                totalQuestionsAsked = 0;
                sessionQuestionsAsked = 0;
                sessionStartTime = Date.now();

                document.getElementById('questionCount').textContent = '0';
                document.getElementById('sessionQuestions').textContent = '0';

                localStorage.removeItem('indicoreStats');

                addMessage('📊 Question counter has been reset successfully!', false);
            }
        }

        function exportStats() {
            const stats = {
                totalQuestions: totalQuestionsAsked,
                sessionQuestions: sessionQuestionsAsked,
                sessionDuration: Math.round((Date.now() - sessionStartTime) / (1000 * 60)),
                exportDate: new Date().toLocaleString(),
                language: document.getElementById('languageSelect').value,
                model: document.getElementById('modelSelect').value
            };

            const dataStr = JSON.stringify(stats, null, 2);
            const dataBlob = new Blob([dataStr], {
                type: 'application/json'
            });
            const url = URL.createObjectURL(dataBlob);

            const link = document.createElement('a');
            link.href = url;
            link.download = `indicore-ai-stats-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            addMessage('📋 Statistics exported successfully!', false);
        }


        // Initialize Azure Speech Recognizer
        const azureSpeechRecognizer = new AzureSpeechRecognizer();

        function resetTranscription() {
            const lang = document.getElementById('languageSelect').value;
            transcription.textContent = translations[lang].transcriptionPlaceholder;
            transcription.style.fontStyle = 'italic';
            transcription.style.color = '#666';
            sendVoiceMessage.disabled = true;
        }

        // --- Azure Speech Synthesis (TTS) Implementation ---
        function initializeAzureSynthesizer() {
            if (azureSynthesizer) {
                azureSynthesizer.close(); // Close existing synthesizer if open
                azureSynthesizer = null;
            }
            try {
                const speechConfig = SpeechSDK.SpeechConfig.fromSubscription(API_CONFIG.azure.key, API_CONFIG.azure.region);
                speechConfig.setProfanity(SpeechSDK.ProfanityOption.Removed);

                azureSynthesizer = new SpeechSDK.SpeechSynthesizer(speechConfig);

                azureSynthesizer.SynthesisStarted = () => {
                    isSpeaking = true;
                    // stopSpeechButton.classList.add('show'); // This is the global button, likely no longer needed
                    stopBotResponseButtonDialog.style.display = 'block'; // Show dialog stop button
                    console.log('Azure speech synthesis started.');
                };

                azureSynthesizer.SynthesisCompleted = () => {
                    isSpeaking = false;
                    // stopSpeechButton.classList.remove('show');
                    stopBotResponseButtonDialog.style.display = 'none'; // Hide dialog stop button
                    console.log('Azure speech synthesis completed.');
                    if (azureSynthesizer) {
                        azureSynthesizer.close();
                        azureSynthesizer = null;
                    }
                    // Re-enable listening after speech completes in speech-to-speech mode, if bot is not stopped
                    if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                        azureSpeechRecognizer.startRecognition();
                    }
                };

                azureSynthesizer.SynthesisCanceled = (s, e) => {
                    isSpeaking = false;
                    // stopSpeechButton.classList.remove('show');
                    stopBotResponseButtonDialog.style.display = 'none'; // Hide dialog stop button
                    console.error(`Azure speech synthesis canceled. Reason: ${e.reason}. Error details: ${e.errorDetails}. For more info: ${e.errorDetails}`);
                    if (azureSynthesizer) {
                        azureSynthesizer.close();
                        azureSynthesizer = null;
                    }
                    // Re-enable listening even if speech was canceled, if bot is not stopped
                    if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                        azureSpeechRecognizer.startRecognition();
                    }
                };

                azureSynthesizer.SynthesisError = (s, e) => {
                    console.error(`Azure speech synthesis error event: ${e.errorDetails}`);
                    isSpeaking = false;
                    // stopSpeechButton.classList.remove('show');
                    stopBotResponseButtonDialog.style.display = 'none'; // Hide dialog stop button
                    // Re-enable listening on error, if bot is not stopped
                    if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                        azureSpeechRecognizer.startRecognition();
                    }
                };

            } catch (error) {
                console.error("Error initializing Azure Speech Synthesizer:", error);
                alert("Failed to initialize speech synthesis. Check Azure Speech SDK and API config.");
            }
        }

        function speak(text, lang) {
            // Do not speak if bot responses are globally stopped
            if (botResponsesStopped) {
                console.log("Bot responses are stopped. Not speaking.");
                return;
            }

            if (isSpeaking) {
                stopSpeech(); // Stop any ongoing speech before starting a new one
            }

            if (!SpeechSDK) {
                console.error('Azure Speech SDK is not loaded. Cannot speak.');
                return;
            }

            if (!azureSynthesizer) {
                initializeAzureSynthesizer();
            }

            if (!azureSynthesizer) { // Check again if initialization failed
                console.error('Azure Speech Synthesizer could not be initialized. Cannot speak.');
                return;
            }

            const voiceName = azureVoiceMap[lang];
            const azureLangCode = azureLanguageMap[lang] || 'en-IN';

            if (!voiceName) {
                console.warn(`No specific Azure voice mapped for language '${lang}'. Falling back to 'en-IN-NeerjaNeural'.`);
                voiceName = 'en-IN-NeerjaNeural';
            }

            // Construct SSML for better control over voice and language
            const ssml = `<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="${azureLangCode}">
                                <voice name="${voiceName}">${text}</voice>
                            </speak>`;

            console.log("Attempting Azure TTS with SSML:", ssml);

            azureSynthesizer.speakSsmlAsync(
                ssml,
                result => {
                    if (result.reason === SpeechSDK.ResultReason.SynthesizingAudioCompleted) {
                        console.log("Synthesis finished successfully for: " + text);
                    } else if (result.reason === SpeechSDK.ResultReason.Canceled) {
                        console.error("Synthesis canceled (result): " + result.errorDetails);
                        isSpeaking = false;
                        // stopSpeechButton.classList.remove('show');
                        stopBotResponseButtonDialog.style.display = 'none';
                    } else {
                        console.error("Synthesis failed with unexpected result reason. Result ID: " + result.resultId + "\n" +
                            "Error reason: " + result.reason + "\n" +
                            "Error details: " + result.errorDetails);
                        isSpeaking = false;
                        // stopSpeechButton.classList.remove('show');
                        stopBotResponseButtonDialog.style.display = 'none';
                    }
                },
                error => {
                    console.error("Critical error during Azure synthesis: " + error);
                    isSpeaking = false;
                    // stopSpeechButton.classList.remove('show');
                    stopBotResponseButtonDialog.style.display = 'none';
                }
            );
        }

        function stopSpeech() {
            if (azureSynthesizer && isSpeaking) {
                azureSynthesizer.close();
                azureSynthesizer = null;
                isSpeaking = false;
                // stopSpeechButton.classList.remove('show');
                stopBotResponseButtonDialog.style.display = 'none'; // Hide dialog stop button
                console.log('Azure speech stopped by user (synthesizer closed).');
            }
            // If in speech-to-speech mode and speech was stopped, restart listening, if bot is not stopped
            if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                azureSpeechRecognizer.startRecognition();
            }
        }
        // --- End Azure Speech Synthesis (TTS) Implementation ---

        function updateInterface(lang) {
            const t = translations[lang];

            document.querySelector('.header p').textContent = t.powered;
            document.querySelector('.settings-toggle').innerHTML = `⚙️ ${t.settings}`;

            document.querySelector('.settings-header h2').textContent = t.settings;
            document.querySelector('.close-settings').textContent = t.close;

            document.querySelector('label[for="languageSelect"]').textContent = t.language;
            document.querySelector('label[for="modelSelect"]').textContent = t.model;
            document.querySelector('label[for="systemPrompt"]').textContent = t.systemPrompt;

            document.getElementById('messageInput').placeholder = t.inputPlaceholder;
            document.getElementById('sendButton').textContent = t.send;
            mainLoadingIndicator.textContent = t.thinking;
            voiceLoadingIndicator.textContent = t.thinking;

            document.querySelector('.voice-dialog-header h3').textContent = t.voiceInput;
            document.getElementById('startListening').textContent = t.startListening;
            document.getElementById('stopListening').textContent = t.stopListening;
            document.getElementById('sendVoiceMessage').textContent = t.send;

            // stopSpeechButton.innerHTML = `🔇 ${t.stopSpeech}`; // This button is removed
            stopBotResponseButtonDialog.textContent = t.stopBotResponseButtonText; // Update the new dialog button's text

            // Update the new toggle button in settings
            if (botResponsesStopped) {
                stopBotToggle.innerHTML = `🔊 ${t.resumeBotResponses}`;
                stopBotToggle.classList.add('active');
            } else {
                stopBotToggle.innerHTML = `🔇 ${t.stopBotResponses}`;
                stopBotToggle.classList.remove('active');
            }

            // Update mode toggle button text
            modeToggle.innerHTML = currentChatMode === 'text-to-text' ? `💬 ${t.textMode}` : `🎤 ${t.speechMode}`;

            updateWelcomeMessage(lang);
        }

        function updateWelcomeMessage(lang) {
            const messagesContainer = document.getElementById('messages');
            if (messagesContainer.children.length === 0 ||
                (messagesContainer.children.length === 1 && messagesContainer.children[0].textContent.includes("Welcome!"))) {
                messagesContainer.innerHTML = '';
                addMessage(translations[lang].welcome, false);
            }
        }

        function saveSettings() {
            const settings = {
                model: document.getElementById('modelSelect').value,
                systemPrompt: document.getElementById('systemPrompt').value,
                language: document.getElementById('languageSelect').value,
                chatMode: currentChatMode,
                botResponsesStopped: botResponsesStopped // Save the new state
            };
            localStorage.setItem('indicoreSettings', JSON.stringify(settings));
        }

        function loadSettings() {
            const saved = localStorage.getItem('indicoreSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('modelSelect').value = settings.model || 'sonar-pro';
                document.getElementById('systemPrompt').value = settings.systemPrompt || 'You are a helpful Multilingual AI assistant. Your name is Indicore-Ai. Provide accurate, detailed, and well-structured responses.';
                document.getElementById('languageSelect').value = settings.language || 'en';

                currentChatMode = settings.chatMode || 'text-to-text';
                botResponsesStopped = settings.botResponsesStopped || false; // Load the new state

                updateInterface(settings.language || 'en');
                applyChatMode(currentChatMode);

                const modelInfo = document.getElementById('modelInfo');
                modelInfo.textContent = modelDescriptions[settings.model || 'sonar-pro'];
            } else {
                addMessage(translations['en'].welcome, false);
                applyChatMode('text-to-text');
            }
        }

        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('active');
            saveSettings();
        }

        // New function to toggle bot responses on/off
        function toggleBotResponses() {
            botResponsesStopped = !botResponsesStopped;
            const lang = document.getElementById('languageSelect').value;
            updateInterface(lang); // Update button text and class
            saveSettings();

            if (botResponsesStopped) {
                stopSpeech(); // Immediately stop any ongoing speech if bot is stopped
                if (currentChatMode === 'speech-to-speech' && azureSpeechRecognizer.isListening) {
                    azureSpeechRecognizer.stopRecognition(); // Stop recognition as well
                }
                addMessage(`Bot responses are now ${translations[lang].stopBotResponses.includes('Stop') ? 'stopped' : 'रोके गए'}.`, false);
            } else {
                addMessage(`Bot responses are now ${translations[lang].resumeBotResponses.includes('Resume') ? 'resumed' : 'पुनः शुरू'}.`, false);
                // If in speech mode, and now resumed, restart listening
                if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !azureSpeechRecognizer.isListening) {
                    azureSpeechRecognizer.startRecognition();
                }
            }
        }


        function toggleMode() {
            if (currentChatMode === 'text-to-text') {
                currentChatMode = 'speech-to-speech';
            } else {
                currentChatMode = 'text-to-text';
                if (azureSpeechRecognizer.isListening) {
                    azureSpeechRecognizer.stopRecognition();
                }
                voiceDialog.style.display = 'none';
                stopSpeech(); // Stop any speech if user switches to text mode
            }
            saveSettings();
            applyChatMode(currentChatMode);
            updateInterface(document.getElementById('languageSelect').value);
        }

        function applyChatMode(mode) {
            if (mode === 'text-to-text') {
                chatContainer.classList.remove('speech-mode');
                chatContainer.classList.add('text-mode');
                messageInput.style.display = 'block';
                sendButton.style.display = 'flex';
                micButton.style.display = 'none';
                voiceDialog.style.display = 'none';
                mainLoadingIndicator.classList.remove('active');
                voiceLoadingIndicator.classList.remove('active');
                stopBotResponseButtonDialog.style.display = 'none'; // Hide the dialog stop button
            } else { // speech-to-speech
                chatContainer.classList.remove('text-mode');
                chatContainer.classList.add('speech-mode');
                messageInput.style.display = 'none';
                sendButton.style.display = 'none';
                micButton.style.display = 'flex';
                mainLoadingIndicator.classList.remove('active');
                voiceDialog.style.display = 'flex';
                // Only start recognition if bot responses are not stopped
                if (!botResponsesStopped) {
                    azureSpeechRecognizer.startRecognition();
                } else {
                    const lang = document.getElementById('languageSelect').value;
                    voiceStatus.textContent = `Bot responses are ${translations[lang].stopBotResponses.includes('Stop') ? 'stopped' : 'रोके गए'}. Listening disabled.`;
                }
            }
        }

        function addMessage(content, isUser) {
            const messagesContainer = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = content;

            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            const language = document.getElementById('languageSelect').value;
            const t = translations[language];

            if (!message) {
                alert(t.errorNoMessage);
                return;
            }

            // Immediately check if bot responses are stopped
            if (botResponsesStopped) {
                addMessage("Bot responses are currently stopped.", false);
                console.log("Bot responses are stopped. Not sending message to API.");
                messageInput.value = ''; // Clear input even if not sent
                // In speech mode, resume listening after user input if bot is stopped (no API call)
                if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !azureSpeechRecognizer.isListening) {
                    azureSpeechRecognizer.startRecognition();
                }
                return; // Stop the function here
            }

            if (currentChatMode === 'text-to-text') {
                addMessage(message, true);
            }
            updateQuestionCounter();
            messageInput.value = '';

            if (currentChatMode === 'text-to-text') {
                mainLoadingIndicator.classList.add('active');
            } else {
                voiceLoadingIndicator.classList.add('active');
                voiceDialog.style.display = 'flex';
                if (azureSpeechRecognizer.isListening) {
                    azureSpeechRecognizer.stopRecognition();
                }
            }
            sendButton.disabled = false; // Keep Send button enabled for new messages
            micButton.disabled = true; // Still disable mic during API call

            try {
                const model = document.getElementById('modelSelect').value;
                let systemPrompt = document.getElementById('systemPrompt').value.trim();

                if (language !== 'en') {
                    systemPrompt += ` Your response MUST be entirely in ${translations[language].languageName}. Do not use any other language. Ensure perfect grammar and natural flow in ${translations[language].languageName}.`;
                }

                console.log(`Sending prompt to Perplexity in ${language} with system prompt: "${systemPrompt}" and user message: "${message}"`);

                const response = await fetch('https://api.perplexity.ai/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_CONFIG.perplexity.key}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [{
                            role: "system",
                            content: systemPrompt
                        }, {
                            role: "user",
                            content: message
                        }],
                        max_tokens: 1000,
                        temperature: 0.7,
                        top_p: 0.9,
                        search_domain_filter: ["perplexity.ai"],
                        return_images: false,
                        return_related_questions: false,
                        search_recency_filter: "month",
                        top_k: 0,
                        stream: false,
                        presence_penalty: 0,
                        frequency_penalty: 1
                    })
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    console.error('API Error from Perplexity:', response.status, errorData);
                    throw new Error(`HTTP ${response.status}: ${errorData}`);
                }

                const data = await response.json();

                let aiResponse = '';
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    aiResponse = data.choices[0].message.content;
                } else {
                    throw new Error('Invalid response format from Perplexity API');
                }

                console.log('Perplexity AI Raw Response Content:', aiResponse);
                console.log('Selected Language for TTS:', language);

                if (currentChatMode === 'text-to-text') {
                    addMessage(aiResponse, false);
                }

                if (currentChatMode === 'speech-to-speech' && aiResponse.trim().length > 0) {
                    speak(aiResponse, language);
                } else if (currentChatMode === 'speech-to-speech' && aiResponse.trim().length === 0) {
                    console.warn("Speech mode active, but AI returned empty response. Not speaking.");
                    if (voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                        azureSpeechRecognizer.startRecognition();
                    }
                } else {
                    console.log("Text mode active, or no content to speak.");
                }

            } catch (error) {
                console.error('Error in sendMessage function:', error);
                let errorMessage = `Error: ${error.message}`;

                if (error.message.includes('401')) {
                    errorMessage = "Invalid API key. Please check your Perplexity API key in settings.";
                } else if (error.message.includes('429')) {
                    errorMessage = "Rate limit exceeded. Please wait a moment and try again.";
                } else if (error.message.includes('402')) {
                    errorMessage = "Insufficient credits. Please add credits to your Perplexity account.";
                } else if (error.message.includes('403')) {
                    errorMessage = "Access denied. Please verify your API key permissions.";
                }

                addMessage(errorMessage, false);
                if (currentChatMode === 'speech-to-speech') {
                    speak(errorMessage, language);
                }

            } finally {
                mainLoadingIndicator.classList.remove('active');
                voiceLoadingIndicator.classList.remove('active');
                sendButton.disabled = false;
                micButton.disabled = false;
                messageInput.focus();
                if (currentChatMode === 'speech-to-speech' && !isSpeaking && !azureSpeechRecognizer.isListening && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                    azureSpeechRecognizer.startRecognition();
                }
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && currentChatMode === 'text-to-text') {
                sendMessage();
            }
        }

        // Voice input event listeners (modified for mode)
        micButton.addEventListener('click', function() {
            if (currentChatMode === 'speech-to-speech') {
                voiceDialog.style.display = 'flex';
                const lang = document.getElementById('languageSelect').value;
                document.getElementById('voiceStatus').textContent = translations[lang].voiceStatusStart;
                resetTranscription();
                // Only start recognition if bot responses are not stopped
                if (!botResponsesStopped) {
                    azureSpeechRecognizer.startRecognition();
                } else {
                    voiceStatus.textContent = `Bot responses are ${translations[lang].stopBotResponses.includes('Stop') ? 'stopped' : 'रोके गए'}. Listening disabled.`;
                }
            }
        });

        closeDialog.addEventListener('click', function() {
            voiceDialog.style.display = 'none';
            finalTranscriptText = '';
            resetTranscription();
            if (azureSpeechRecognizer.recognizer && azureSpeechRecognizer.isListening) {
                azureSpeechRecognizer.stopRecognition();
            }
            stopSpeech(); // Stop any ongoing speech if dialog is closed
        });

        startListening.addEventListener('click', function() {
            if (!botResponsesStopped) {
                azureSpeechRecognizer.startRecognition();
            } else {
                const lang = document.getElementById('languageSelect').value;
                voiceStatus.textContent = `Bot responses are ${translations[lang].stopBotResponses.includes('Stop') ? 'stopped' : 'रोके गए'}. Cannot start listening.`;
            }
        });

        stopListening.addEventListener('click', function() {
            azureSpeechRecognizer.stopRecognition();
        });

        sendVoiceMessage.addEventListener('click', function() {
            const transcriptText = transcription.textContent.trim();
            const lang = document.getElementById('languageSelect').value;

            if (transcriptText &&
                transcriptText !== translations[lang].transcriptionPlaceholder) {
                messageInput.value = transcriptText;
                voiceDialog.style.display = 'none';
                sendMessage();

                finalTranscriptText = '';
                resetTranscription();
            }
        });

        // Event listener for the new "Stop Bot Response" button inside the dialog
        stopBotResponseButtonDialog.addEventListener('click', stopSpeech);

        document.getElementById('languageSelect').addEventListener('change', function() {
            updateInterface(this.value);
            saveSettings();
        });

        document.getElementById('modelSelect').addEventListener('change', function() {
            const modelInfo = document.getElementById('modelInfo');
            modelInfo.textContent = modelDescriptions[this.value];
            saveSettings();
        });

        document.addEventListener('DOMContentLoaded', async function() {
            loadSettings(); // Load all settings including botResponsesStopped
            loadQuestionStats();

            if (typeof SpeechSDK === 'undefined') {
                console.error('Azure Speech SDK not loaded');
                document.getElementById('voiceStatus').textContent = 'Azure Speech SDK not loaded. Voice input and output disabled.';
                micButton.disabled = true;
                // If SDK is not loaded, ensure speech-related buttons are disabled
                startListening.disabled = true;
                stopListening.disabled = true;
                sendVoiceMessage.disabled = true;
                stopBotResponseButtonDialog.disabled = true; // Disable this dialog button as well
                stopBotToggle.disabled = true; // Disable this toggle if speech isn't available
            } else {
                initializeAzureSynthesizer();
                micButton.disabled = false;
            }
        });
    const BACKEND_URL = "https://indicore-ok6j7ky8j-manas-mathurs-projects.vercel.app/api";

async function checkBackend() {
    try {
        const response = await fetch(`${BACKEND_URL}/ping`);
        if (response.ok) {
            document.getElementById("backend-status").textContent = "Backend Status: ✅ Connected";
        } else {
            document.getElementById("backend-status").textContent = "Backend Status: ❌ Not Connected";
        }
    } catch (err) {
        document.getElementById("backend-status").textContent = "Backend Status: ❌ Not Connected";
        console.error("Backend connection error:", err);
    }
}

checkBackend();


    </script>
 

</body>

</html>
